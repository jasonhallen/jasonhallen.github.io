<!DOCTYPE html>
<html lang="en"><head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Jason Hallen">
<meta name="keywords" content="Jason Hallen, blog, computer music, algorithmic music, electronic music, csound, synthesis, experimental music, Csound, drum machine, Cabbage, tr-808, rhythm">
<meta name="description" content="Coding a drum machine from scratch in Csound.">
<!-- <title></title> -->

<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-9FW0V3NTDJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9FW0V3NTDJ');
</script>
<link href="/images/favicon.ico" rel="shortcut icon">
<link href="https://fonts.googleapis.com/css?family=Josefin+Slab" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro" rel="stylesheet">
<!-- <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet"> -->
<link rel="stylesheet" href="/style.css"><title>Project: Drum Machine</title></head>

<body>
    <div id="header">
        <span id="jason-hallen">
            <a href="/">Jason Hallen</a>
        </span>
        <div id="nav">
            <ul>
                <li class="active"><a href="/notes">Notes</a></li>
                <li><a href="/output">Output</a></li>
                <li><a href="/info">Info</a></li>
            </ul>
        </div>        
    </div>
    <div id="page-content"><div id="post-section"><h2>Project: Drum Machine</h2><span class="muted date">March 16, 2020</span>

<p>I can’t remember why I decided to build a drum machine in Csound. After spending a few weeks on the <a href="study-james-tenney">James Tenney instrument</a>, which generates notes in a very randomized way, I must have been interested in generating notes within a metrical framework. In other words, I wanted to learn how to use the <code>metro</code> opcode.</p>
<p>But first, why would you build a drum machine when there are dozens of free, full-featured drum machines available online? Two reasons:</p>
<ol>
<li>You’ll learn a lot about Csound by building one yourself.</li>
<li>You can custom code the drum machine to do anything you’d like.</li>
</ol>

<h3 id="sampling-drum-sounds">Sampling Drum Sounds</h3>
<p>The first step was deciding how to generate the drum sounds. Rather than synthesize the sounds from scratch I decided to play pre-recorded drum samples with the <a href="http://www.csounds.com/manual/html/loscil.html"><code>loscil</code></a> opcode. I found a huge collection of free drum machine samples on <a href="https://reverb.com/software/samples-and-loops/reverb/3514-reverb-drum-machines-the-complete-collection">Reverb.com</a> and a more extensive collection of free TR-808 samples from <a href="http://smd-records.com/tr808/?page_id=14">Michael Fischer</a>. I chose several of my favorite samples and loaded them into function tables with <a href="http://www.csounds.com/manual/html/GEN01.html">GEN routine 01</a>. The <code>loscil</code> opcode would then play the different drum parts depending on which function table it was told to read from.</p>
<h3 id="controlling-rhythmic-patterns">Controlling Rhythmic Patterns</h3>
<p>The most challenging part of designing a drum machine is deciding how the user will interact with the machine to create rhythmic patterns. The trick is striking the right balance between controlability and simplicity. You want to provide enough ways for the user to control the drum machine and do exactly what they want to do musically, but you also want the drum machine to be simple enough for the user to use it without overwhelming the user with all the options.</p>
<figure><img src="/images/drum_machine.gif" alt="Drum machine">
<figcaption>Screenshot of the drum machine interface built in Cabbage.</figcaption>
</figure>

<p>I was most interested in how the user will control the rhythmic pattern of each drum part. I decided not to have the user click a box for every 1/16th note of every drum part because there would be a total of 192 boxes on the screen! I was afraid that would be overwhelming to the user and difficult to control in real time. Instead, I decided to have the user control the rhythmic patterns by entering and modifying strings of characters. My thinking was that the 24 string fields are visually simpler than 192 buttons, and it’s faster for the user to type characters than to move and click the mouse dozens of times.</p>
<p>Here's a quick overview of what the characters in the strings mean.</p>
<ul>
<li>Each character represents an 1/8th note.</li>
<li><strong>1</strong> = the first 1/16th note of the 1/8th note, low volume</li>
<li><strong>2</strong> = the first 1/16th note of the 1/8th note, high volume</li>
<li><strong>3</strong> = the second 1/16th note of the 1/8th note, low volume</li>
<li><strong>4</strong> = the second 1/16th note of the 1/8th note, high volume</li>
<li><strong>5</strong> = both the first and second 1/16th notes of the 1/8th note, low volume</li>
<li><strong>6</strong> = both the first and second 1/16th notes of the 1/8th note, high volume</li>
<li><strong>e</strong> = rest, no note sounds</li>
<li><strong>r</strong> = randomly pick any of the above values</li>
</ul>
<p>Under the hood, this drum machine reads the various widget values into arrays, cycles through the active rows (i.e. drum parts) and columns (i.e. rhythmic sequences), parses and interprets the strings, and triggers the drum samples.</p>
<h3 id="controlling-widgets-in-cabbage">Controlling Widgets in Cabbage</h3>
<p>I began coding the drum machine in <a href="https://csoundqt.github.io/">CsoundQt</a>, but managing the widgets (i.e. buttons, knobs, and sliders) became cumbersome as the drum machine became more complex. I needed a more efficient way to work with lots of widgets in an instrument. On the Csound listserv [edit: the listserv has mostly moved over to the <a href="https://forum.csound.com/">Csound forum</a>] I saw someone recommend another Csound development environment called <a href="https://cabbageaudio.com/">Cabbage</a>, so I decided to give it a shot. There was a learning curve going from CsoundQt to Cabbage, but I could see the benefits.</p>
<ul>
<li>Cabbage offers a brilliant way to create and manipulate widgets through the Csound code itself. This cut down on development time a lot.</li>
<li>You can easily export your instruments as VST/AU plugins for use in your preferred digital audio workstation.</li>
<li>Cabbage has fantastic <a href="https://cabbageaudio.com/docs/introduction/">documentation</a>, and the lead developer, Rory Walsh, responds quickly and helpfully to all requests on the <a href="https://forum.cabbageaudio.com/">Cabbage Forum</a>.</li>
</ul>
<figure><img src="/images/drum_machine_cabbage.jpg" alt="Drum machine in Cabbage">
<figcaption>Screenshot of Cabbage, code, and drum machine.</figcaption>
</figure>

<h3 id="special-features">Special Features</h3>
<ul>
<li><strong>Randomization</strong> - This comes in two flavors. 1) You can hit the "Randomize" button to generate random rhythmic patterns for all the drum parts. 2) The "r" character in the strings randomly picks a value for the 1/8th notes. This second option is the secret sauce that brings the rhythms of this drum machine to life.</li>
<li><strong>Probability</strong> - This determines how likely any given note will be to sound, and it ranges from 0% to 100% chance of sounding. When set to 50%, only about half of the notes will sound as determined by random chance. As you turn the probability down the music gets more sparse and the rhythms become less identifiable.</li>
<li><strong>Swing</strong> - Any good drum machine should have a swing feature that delays every other 1/8th or 1/16th note.</li>
<li><strong>Deviation</strong> - This determines how much the exact timing of the notes can deviate from the tempo. Turning up the deviation increases the looseness of the rhythms. If you turn it up too high the rhythms begin to sound chaotic.</li>
</ul>
<figure><audio controls="controls"> Your browser does not support the audio element.<source src="/audio/hallen_drum_machine_2019_9_6.mp3" type="audio/mpeg"></audio>
<figcaption>"hallen_drum_machine_2019_9_6.mp3" -- A live performance of the drum machine.</figcaption>
</figure>

<p>Here's a recording of a live performance I did with this drum machine. It's pretty simple, but it's made from scratch! That's as far as I got on the drum machine because another project grabbed my attention at the time. I'm sure I'll return to this though. When I do, I'd like to expand the number of characters the user can use to control the rhythmic patterns. I'd also like to spend more time "tuning the randomness" in the drum machine because truly random rhythmic patterns are often not satisfying musically. That's for another day.</p>
<div id="prev-next-container"><span><a href="/notes/study-mark-fell-rhythms" class="readmore">Newer</a></span><span class="older-button"><a href="/notes/study-james-tenney" class="readmore">Older</a></span></div></div><div id="comments-section"><div id="comment-form"><form class="js-form" method="post" action="https://staticman-comments-rbo6.onrender.com/v3/entry/github/jasonhallen/jasonhallen.github.io/main/comments">
    
    <!-- <input type="hidden" name="options[origin]" value="{{ page.url | absolute_url }}"> -->
    <input type="hidden" name="options[parent]" value="https://jasonhallen.com/blog/project-drum-machine.html">
    <!-- <input name="options[redirect]" type="hidden" value="https://jasonhallen.com/thanks"> -->
    <input type="hidden" id="comment-replying-to-uid" name="fields[replying_to_uid]" value="">
    <input type="hidden" name="options[slug]" value="project-drum-machine">
    
    <!-- reCaptcha -->
    <input type="hidden" name="options[reCaptcha][siteKey]" value="6LcsNJIhAAAAAIF7ND_Y8QPGuocbqYoe3LPpNWPI">
    <input type="hidden" name="options[reCaptcha][secret]" value="J/1tx/gxjjcF4Qw17kZ0QUhUK9xnotL31qIetlT0EGmt7rZEyYfRDfKKHit/hxajHF4EV898b9pWqF0nbhZVa+j+AmxyMrcJTvP7lD0Fvfdk6fK/W/6OMe1q3dOROo/HIF5lLmDcdFMKc9L1Y3T0wDNuStn2lvL3v2ECnajXG5/CSurNFRnFq1k1iwGvHn5XLeypNgz08MKk+5E5f55DyEeRwxtLu2wAaiyIBISpboEas5v9OZpPoclYnYWneAiX0CeccxGSL3EyxJ3CCD9GSJsFrrOYAPRRujw4hXmRzAzzJunSLd1V4icFPaqlsqWYAGYMehQeeHlV77MAcg7gxeSJv9GVyrfbtg82yhsASgtkGhtUFEmN7AenM1XZs4TDqUUxP01o9Gj/oYmfGQUdr734IVewVQkcm65zF092ZSeeTefX/5s8cZedPiFK6bvLylbFxu/s4kLG482H/ZU64QdSIyrDuSzOISbZo+0Yd9OlElvkgeZML6+pyjd8SrNjxfCSA1bgOhb+3aGfXKVw+JxinWCizR2JB6Q/FOZzEa4I0aefzOeGwNK8XGC/vHzmt/58KFeEDNTpse77cHywvoT74XVIciJcPUvTrq6rAw5tkaekmuDX03Trefxo+pAMBXqj8wy06mgYsg721XNd8IpE+Qk7wPs/Dv8BfEhH6sc=">
    
    <h2 id="comment-form-header">Leave a Comment</h2>

    <div class="textfield">
        <p>Your email address will not be published. Required fields are marked *</p>
        <label for="comment-form-message"><strong>Comment *</strong></label>
        <textarea class="textfield__input" name="fields[message]" type="text" id="comment-form-message" placeholder="[You can use Markdown.]" required="" rows="6"></textarea>
    </div>

    <div class="textfield">
        <label for="comment-form-name"><strong>Name *</strong></label>
        <br>
        <input class="textfield__input" name="fields[name]" type="text" id="comment-form-name" required="">
    </div>
    
    <div class="textfield">
        <label for="comment-form-email"><strong>Email</strong></label>
        <br>
        <input class="textfield__input" name="fields[email]" type="email" id="comment-form-email">
    </div>
    
    <div class="textfield hp">
    <label for="hp">
        <input class="textfield__input" name=" hp" id="hp" type="text" placeholder="Leave blank">
    </label>
    </div>

    <div id="reCaptcha" class="g-recaptcha" data-sitekey="6LcsNJIhAAAAAIF7ND_Y8QPGuocbqYoe3LPpNWPI"></div>

    <div id="submit-cancel-buttons">
        <button class="readmore" id="comment-form-submit">
        Submit
        </button>

        <button type="button" class="readmore" id="cancel-comment-reply-link" style="display: none">
        Cancel
        </button>
        <!-- <p id="recaptcha-fine-print"><small>This site is protected by reCAPTCHA and the Google <a href="https://policies.google.com/privacy">Privacy Policy</a> and <a href="https://policies.google.com/terms">Terms of Service</a> apply.</small></p> -->
    </div>

</form>

<div id="modal-wrapper" style="display: none;">
    <article class="modal">
        <img class="modal-image" src="">
            <div id="modal-text-wrapper">
            <h3 class="modal-title js-modal-title"></h3>
            <div class="mdl-card__supporting-text js-modal-text"></div>
            <div class="mdl-card__actions mdl-card--border">
                <button class="button readmore mdl-button--colored mdl-js-button mdl-js-ripple-effect js-close-modal">
                    Close
                </button>
            </div>
        </div>
    </article>
</div>

<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none">
    <symbol id="icon-loading" viewBox="149.8 37.8 499.818 525"><path d="M557.8 187.8c13.8 0 24.601-10.8 24.601-24.6S571.6 138.6 557.8 138.6s-24.6 10.8-24.6 24.6c0 13.2 10.8 24.6 24.6 24.6zm61.2 90.6c-16.8 0-30.6 13.8-30.6 30.6s13.8 30.6 30.6 30.6 30.6-13.8 30.6-30.6c.6-16.8-13.2-30.6-30.6-30.6zm-61.2 145.2c-20.399 0-36.6 16.2-36.6 36.601 0 20.399 16.2 36.6 36.6 36.6 20.4 0 36.601-16.2 36.601-36.6C595 439.8 578.2 423.6 557.8 423.6zM409 476.4c-24 0-43.2 19.199-43.2 43.199s19.2 43.2 43.2 43.2 43.2-19.2 43.2-43.2S433 476.4 409 476.4zM260.8 411c-27 0-49.2 22.2-49.2 49.2s22.2 49.2 49.2 49.2 49.2-22.2 49.2-49.2-22.2-49.2-49.2-49.2zm-10.2-102c0-27.6-22.8-50.4-50.4-50.4-27.6 0-50.4 22.8-50.4 50.4 0 27.6 22.8 50.4 50.4 50.4 27.6 0 50.4-22.2 50.4-50.4zm10.2-199.8c-30 0-54 24-54 54s24 54 54 54 54-24 54-54-24.6-54-54-54zM409 37.8c-35.4 0-63.6 28.8-63.6 63.6S374.2 165 409 165s63.6-28.8 63.6-63.6-28.2-63.6-63.6-63.6z"></path>
    </symbol>
</svg></div></div></div>
    <script src="/comments.js"></script>


<script src="https://www.google.com/recaptcha/api.js?render=reCAPTCHA_site_key"></script>
</body><!-- <script src="https://www.google.com/recaptcha/api.js" async defer></script> --></html>